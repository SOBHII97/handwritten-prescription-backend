<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prescription Processor</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    img { max-width: 100%; border: 2px solid #4CAF50; margin-top: 10px; }
    button { margin-top: 10px; padding: 5px 10px; }
    pre { background: #f0f0f0; padding: 10px; }
  </style>
</head>
<body>
  <h2>Upload Prescription Image</h2>

  <input type="file" id="imageInput" accept="image/*"><br><br>

  <button onclick="callExtractText()">Extract Text</button>
  <button onclick="callSegmentation()">Segmentation</button>
  <button onclick="callTextOnly()">Text Only (from manual input)</button>

  <div id="result" style="margin-top:20px;"></div>

  <script>
    const resultDiv = document.getElementById('result');

    function getImageFormData() {
      const fileInput = document.getElementById('imageInput');
      const formData = new FormData();
      formData.append("image", fileInput.files[0]);
      return formData;
    }

    async function callExtractText() {
      resultDiv.innerHTML = "Processing...";
      const formData = getImageFormData();
      const response = await fetch('http://127.0.0.1:5000/process/extract_text', {
        method: 'POST',
        body: formData
      });
      const data = await response.json();
      resultDiv.innerHTML = `
        <h3>Extracted Text</h3>
        <p>${data.text}</p>
        <h3>Segmented Image</h3>
        <img src="data:image/jpeg;base64,${data.segmented_image}">
      `;
    }

    async function callSegmentation() {
      resultDiv.innerHTML = "Segmenting...";
      const formData = getImageFormData();
      const response = await fetch('http://127.0.0.1:5000/process/segmentation', {
        method: 'POST',
        body: formData
      });

      const blob = await response.blob();
      const imageUrl = URL.createObjectURL(blob);

      resultDiv.innerHTML = `
        <h3>Segmented Image</h3>
        <img src="${imageUrl}">
      `;
    }

    async function callTextOnly() {
      const inputText = prompt("Enter text to extract medications:");
      if (!inputText) return;
      const response = await fetch('http://127.0.0.1:5000/process/process_text', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text: inputText })
      });
      const data = await response.json();
      resultDiv.innerHTML = `
        <h3>Extracted Medications</h3>
        <pre>${JSON.stringify(data, null, 2)}</pre>
      `;
    }
  </script>
</body>
</html>
